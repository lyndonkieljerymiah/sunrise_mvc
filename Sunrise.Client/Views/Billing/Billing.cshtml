
<div ng-controller="billingController as $ctrl" ng-init="$ctrl.init('@ViewBag.Id')">
    <spinner></spinner>
    <toaster-container toaster-options="{'time-out': 3000, 'close-button':true, 'animation-class': 'toast-top-right'}"></toaster-container>
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h4>Billing</h4>
        </div>
        <div class="panel-body">
            <!--- General Information -->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">Tenant Information</div>
                        <div class="panel-body">
                            <div class="col-md-9">
                                <div class="body-content">
                                    <div class="row">
                                        <div class="col-md-2">Name:</div>
                                        <div class="col-md-10">{{sales.name}}</div>
                                    </div>
                                    <div class="row" ng-show="sales.qatarId">
                                        <div class="col-md-2">Qatar Id:</div>
                                        <div class="col-md-10">{{sales.qatarId}}</div>
                                    </div>
                                    <div class="row" ng-show="sales.crNo">
                                        <div class="col-md-2">CR No:</div>
                                        <div class="col-md-4">{{sales.crNo}}</div>
                                        <div class="col-md-2">Validity Date:</div>
                                        <div class="col-md-4">{{sales.validityDate | date : 'MM/dd/yyyy'}}</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-2">Address:</div>
                                        <div class="col-md-10">{{sales.address}}</div>
                                    </div>
                                </div>
                            </div>
                            <!-- status component -->
                            <div class="panel panel-danger col-md-3">
                                <div class="panel-body">
                                    <strong class="text-success text-center">Status: {{sales.status}}</strong>
                                </div>
                            </div>
                            <!--end component-->

                            <table class="table">
                                <tr>
                                    <th>Villa No</th>
                                    <th>Rental Type</th>
                                    <th>Period Start</th>
                                    <th>Period End</th>
                                    <th>Amount</th>
                                    <th>Monthly Payable</th>
                                    <th>Status</th>
                                </tr>
                                <tr>
                                    <td>{{sales.villa.villaNo}}</td>
                                    <td>{{sales.rentalType}}</td>
                                    <td>{{sales.periodStart | date: "MM/dd/yyyy"}}</td>
                                    <td>{{sales.periodEnd | date: "MM/dd/yyyy"}}</td>
                                    <td>{{sales.amountPayable | currency :"QR "}}</td>
                                    <td>{{sales.villa.ratePerMonth | currency :"QR "}}</td>
                                    <td>{{sales.villa.status}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end general-->
            <!-- payment details component -->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">Payment Details</div>
                        <div class="panel-body">
                            <div class="col-md-12">
                                <table class="table table-bordered table-condensed">
                                    <tr class="active">
                                        <th style="width:10%;" class="text-center">Date</th>
                                        <th style="width:10%;" class="text-center">Cheque No</th>
                                        <th class="text-center">Covered Period</th>
                                        <th style="width:12%;text-align:center">Amount</th>
                                        <th style="width:10%;text-align:center">Status</th>
                                        <th style="width:10%;text-align:center">Status Date</th>
                                        <th></th>
                                    </tr>
                                    <tbody>
                                        <tr ng-repeat="payment in sales.payments"
                                            ng-class="{active: $index==sales.currentPaymentIndex}">
                                            <td class="text-center">{{payment.paymentDate | date: 'MM/dd/yyyy'}}</td>
                                            <td class="text-center">{{payment.chequeNo}}</td>
                                            <td class="text-left">{{payment.coveredPeriodFrom | date : 'MM/dd/yyyy'}} - {{payment.coveredPeriodTo | date : 'MM/dd/yyyy'}}</td>
                                            <td class="text-right">{{payment.amount | currency:"QR "}}</td>
                                            <td class="text-center">{{payment.status}}</td>
                                            <td class="text-center">{{payment.statusDate | date: 'MM/dd/yyyy'}}</td>

                                            <th style="width:5%;text-align:center">
                                                <!-- Single button -->
                                                <div class="btn-group"
                                                     uib-dropdown
                                                     ng-show="payment.writeState">
                                                    <button id="single-button" type="button" class="btn btn-primary btn-sm"
                                                            uib-dropdown-toggle
                                                            ng-disabled="disabled">
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                                                        <li role="menuitem"><a href="#" ng-click="$ctrl.edit($index,$event)">Edit</a></li>
                                                        <li role="menuitem"><a href="#" ng-click="$ctrl.remove($index)">Remove</a></li>
                                                    </ul>
                                                </div>
                                            </th>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr class="active">
                                            <td colspan="6"></td>
                                            <td class="text-center">
                                                <!--<button class="btn btn-sm btn-primary" ng-click="$ctrl.addNewPayment()"><i class="fa fa-plus-circle"></i></button>-->
                                                <!-- Single button -->
                                                <div class="btn-group"
                                                     uib-dropdown>
                                                    <button id="single-button" type="button" class="btn btn-primary btn-sm"
                                                            uib-dropdown-toggle
                                                            ng-disabled="disabled">
                                                        <span class="fa fa-plus-circle"></span>
                                                    </button>
                                                    <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">
                                                        <li role="menuitem"><a href="#" ng-click="$ctrl.addNewPayment()">Add New</a></li>
                                                        <li class="divider" role="menuitem"></li>
                                                        <li role="menuitem"><a href="#">Generate 6 Months</a></li>
                                                        <li role="menuitem"><a href="#">Generate 12 Months</a></li>
                                                    </ul>
                                                </div>
                                            </td>

                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <hr />
                            <div class="col-md-4 pull-right">
                                <div class="panel panel-danger">
                                    <div class="panel-body">
                                        <p class="text-danger text-left"><i class="fa fa-money"></i> Total Received: {{sales.totalReceivedPayment | currency : "QR "}}</p>
                                        <p class="text-danger text-left"><i class="fa fa-money"></i> Total Payment: {{sales.totalPayment | currency : "QR "}}</p>
                                        <p class="text-danger text-left"><i class="fa fa-money"></i> Remaining Balance: {{sales.totalBalance | currency : "QR "}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-2 pull-right">
                                    <button class="btn btn-primary btn-block" ng-click="$ctrl.save()" ng-show="showSaveButton"><i class="fa fa-save"></i> Save</button>
                                </div>
                            </div>
                            
                            <!-- template -->
                            <script type="text/ng-template" id="myModalContent.html">
                                <form id="paymentForm" class="form-horizontal">
                                    <div class="modal-header">
                                        <h3 class="modal-title" id="modal-title">Payment</h3>
                                    </div>
                                    <div class="modal-body">
                                        <!--type -->
                                        <div class="form-group">
                                            <label class="col-md-2 text-right">Type:</label>
                                            <div class="col-md-4">
                                                <select class="form-control" placheholder="Term" ng-model="$ctrl.payment.paymentTypeCode" ng-change="$ctrl.changeBehaviourWhenSelectingTerm()">
                                                    <option ng-repeat="term in $ctrl.paymentObject.terms" value="{{term.value}}">{{term.text}}</option>
                                                </select>
                                            </div>
                                            <div ng-hide="$ctrl.payment.chequeFieldDisabled">
                                                <label class="col-md-2 text-right">Mode:</label>
                                                <div class="col-md-4">
                                                    <select class="form-control" ng-model="$ctrl.payment.paymentModeCode">
                                                        <option ng-repeat="mode in $ctrl.paymentObject.modes" value="{{mode.value}}">{{mode.text}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end type-->
                                        <div class="form-group">
                                            <label class="col-md-2 text-right">Date:</label>
                                            <div class="col-md-10">
                                                <div class="input-group">
                                                    <input type="text" class="form-control"
                                                           uib-datepicker-popup="MM/dd/yyyy"
                                                           ng-model="$ctrl.payment.paymentDate"
                                                           is-open="$ctrl.dateTimePicker.isOpen[0]"
                                                           datepicker-options="dateOptions"
                                                           ng-required="true"
                                                           close-text="Close"
                                                           alt-input-formats="altInputFormats" />
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-default" ng-click="$ctrl.dateTimePicker.toggle($event,0)"><i class="fa fa-calendar"></i></button>
                                                    </span>
                                                </div>
                                                <span ng-show="errorState['vm.paymentdate']">{{errorState['vm.paymentdate']}}</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 text-right">Cheque No:</label>
                                            <div class="col-md-10">
                                                <input type="text" ng-disabled="$ctrl.payment.chequeFieldDisabled" name="chequeNo" id="chequeNo" class="form-control" ng-model="$ctrl.payment.chequeNo" />
                                                <span ng-show="errorState['vm.chequeno']">{{errorState['vm.chequeno']}}</span>
                                            </div>
                                        </div>
                                        <div class="form-group" ng-hide="$ctrl.payment.paymentTypeCode == 'ptcs'">
                                            <label class="col-md-2 text-right">Bank:</label>
                                            <div class="col-md-10">
                                                <select ng-model="$ctrl.payment.bankCode" class="form-control">
                                                    <option value="">--Select Bank--</option>
                                                    <option ng-repeat="bank in $ctrl.paymentObject.banks" value="{{bank.value}}">{{bank.text}}</option>
                                                </select>
                                                <span ng-show="errorState['vm.bankcode']">{{errorState['vm.bankcode']}}</span>
                                            </div>
                                        </div>
                                        <div class="page-header">
                                            <strong>Covered Period</strong>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 text-right">Start:</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input type="text" class="form-control"
                                                           uib-datepicker-popup="MM/dd/yyyy"
                                                           ng-model="$ctrl.payment.coveredPeriodFrom"
                                                           is-open="$ctrl.dateTimePicker.isOpen[1]"
                                                           datepicker-options="dateOptions"
                                                           ng-required="true"
                                                           close-text="Close"
                                                           alt-input-formats="altInputFormats" />
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-default" ng-click="$ctrl.dateTimePicker.toggle($event,1)"><i class="fa fa-calendar"></i></button>
                                                    </span>
                                                </div>
                                                <span ng-show="errorState['vm.coveredperiodfrom']">{{errorState['vm.coveredperiodfrom']}}</span>
                                                <span ng-show="errorState['perioderror']">{{errorState['perioderror']}}</span>
                                            </div>
                                            <label class="col-md-2 text-right">End:</label>
                                            <div class="col-md-4">
                                                <div class="input-group">
                                                    <input type="text" class="form-control"
                                                           uib-datepicker-popup="MM/dd/yyyy"
                                                           ng-model="$ctrl.payment.coveredPeriodTo"
                                                           is-open="$ctrl.dateTimePicker.isOpen[2]"
                                                           datepicker-options="dateOptions"
                                                           ng-required="true"
                                                           close-text="Close"
                                                           alt-input-formats="altInputFormats" />
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-default" ng-click="$ctrl.dateTimePicker.toggle($event,2)"><i class="fa fa-calendar"></i></button>
                                                    </span>
                                                </div>
                                                <span ng-show="errorState['vm.coveredperiodto']">{{errorState['vm.coveredperiodto']}}</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 text-right">Amount:</label>
                                            <div class="col-md-10">
                                                <input type="text" name="amount" id="amount" class="form-control text-right" placeholder="Amount" ng-model="$ctrl.payment.amount" />
                                                <span ng-show="errorState['vm.amount']">{{errorState['vm.amount']}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn btn-primary" ng-click="$ctrl.save()"><i class="fa fa-save"></i> Save</button>
                                        <button class="btn btn-danger" ng-click="$ctrl.cancel()"><i class="fa fa-undo"></i> Cancel</button>
                                    </div>
                                </form>

                            </script>
                            <!-- end -->

                        </div>
                    </div>
                </div>
            </div>
            <!-- end -->
        </div>
    </div>
</div>





<!-- payment details component -->
@section scripts {
    <script src="@Url.Content("~/Scripts/app/data/payment-manager.data.js")"></script>
    <script src="@Url.Content("~/Scripts/app/controller/billingController.js")"></script>
}



